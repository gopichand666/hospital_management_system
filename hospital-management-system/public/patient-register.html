<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Registration - HMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body.background-image-container {
            /* Replace 'images/medical_background.jpg' with the actual path to your image */
            /* This path is relative to the HTML file itself, assuming the image is in public/images */
            background-image: url('https://img.freepik.com/free-photo/doctor-with-stethoscope-hand-hospital-background_1423-1.jpg');
            background-size: cover;
            background-position: center;      
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        /* Optional: Semi-transparent overlay for better text readability */
        body.background-image-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.4); /* Dark overlay, 40% opacity */
            z-index: 0;
        }

        /* Ensure the main content box is above the overlay */
        body > div {
            position: relative;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen background-image-container">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-sm">
        <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Patient Registration</h2>
        <form id="patientRegistrationForm" class="space-y-4">
            <div>
                <label for="regPatientName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                <input type="text" id="regPatientName" name="fullName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" required>
                <p id="error-fullName" class="text-red-500 text-xs mt-1 hidden">Full Name must contain only alphabets and spaces.</p>
            </div>
            <div>
                <label for="regPatientEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" id="regPatientEmail" name="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" required>
                <p id="error-email" class="text-red-500 text-xs mt-1 hidden">Please enter a valid email address.</p>
            </div>
            <div>
                <label for="regPatientUsername" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                <input type="text" id="regPatientUsername" name="username" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" required>
                <p id="error-username" class="text-red-500 text-xs mt-1 hidden">Username is required.</p>
            </div>
            <div>
                <label for="regPatientPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="regPatientPassword" name="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" required>
                <p id="error-password" class="text-red-500 text-xs mt-1 hidden">Password must be at least 6 characters and contain one special character.</p>
            </div>
            <div>
                <label for="regPatientConfirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                <input type="password" id="regPatientConfirmPassword" name="confirmPassword" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" required>
                <p id="error-confirmPassword" class="text-red-500 text-xs mt-1 hidden">Passwords do not match.</p>
            </div>
            <div>
                <label for="regPatientDob" class="block text-sm font-medium text-gray-700 mb-1">Date of Birth</label>
                <input type="date" id="regPatientDob" name="dob" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" required>
                <p id="error-dob" class="text-red-500 text-xs mt-1 hidden">Please enter a valid date of birth.</p>
            </div>
             <div>
                <label for="regGender" class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                <select id="regGender" name="gender" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" required>
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
                <p id="error-gender" class="text-red-500 text-xs mt-1 hidden">Please select a gender.</p>
            </div>
            <div>
                <label for="regPhoneNumber" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                <input type="tel" id="regPhoneNumber" name="phoneNumber" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" required>
                <p id="error-phoneNumber" class="text-red-500 text-xs mt-1 hidden">Please enter a valid 10-digit phone number.</p>
            </div>
            <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">
                Register
            </button>
        </form>
        <p class="mt-4 text-center text-sm text-gray-600">
            Already have an account? <a href="/patient-login.html" class="text-purple-600 hover:text-purple-800">Login here</a>
        </p>
        <p class="mt-2 text-center text-sm text-gray-600">
            <a href="/" class="text-purple-600 hover:text-purple-800">Back to Home</a>
        </p>
    </div>
    <script src="/js/auth.js"></script>
    <script>
        document.getElementById('patientRegistrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            // Hide all previous error messages
            document.querySelectorAll('p[id^="error-"]').forEach(p => p.classList.add('hidden'));

            let hasError = false;

            // Full Name validation
            if (!/^[a-zA-Z\s]+$/.test(data.fullName)) {
                document.getElementById('error-fullName').classList.remove('hidden');
                hasError = true;
            }

            // Email validation
            if (!/^\S+@\S+\.\S+$/.test(data.email)) {
                document.getElementById('error-email').classList.remove('hidden');
                hasError = true;
            }
            
            // Username validation
            if (data.username.trim() === '') {
                document.getElementById('error-username').classList.remove('hidden');
                hasError = true;
            }

            // Password validation: minimum 6 characters and at least one special character
            const passwordRegex = /^(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]).{6,}$/;
            if (!passwordRegex.test(data.password)) {
                document.getElementById('error-password').classList.remove('hidden');
                hasError = true;
            }

            if (data.password !== data.confirmPassword) {
                document.getElementById('error-confirmPassword').classList.remove('hidden');
                hasError = true;
            }
            
            // Date of Birth validation
            if (!data.dob) {
                document.getElementById('error-dob').classList.remove('hidden');
                hasError = true;
            }
            
            // Gender validation
            if (!data.gender) {
                document.getElementById('error-gender').classList.remove('hidden');
                hasError = true;
            }

            // Phone Number validation: exactly 10 digits
            if (!/^\d{10}$/.test(data.phoneNumber)) {
                document.getElementById('error-phoneNumber').classList.remove('hidden');
                hasError = true;
            }

            if (hasError) {
                return;
            }

            try {
                const response = await fetch('/api/patient/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();

                if (response.ok) {
                    alert('Registration successful! You can now log in.');
                    window.location.href = '/patient-login.html';
                } else {
                    alert(`Registration failed: ${result.msg || 'An error occurred.'}`);
                }
            } catch (error) {
                console.error('Network or server error:', error);
                alert('An error occurred during registration. Please try again later.');
            }
        });
    </script>
</body>
</html>
